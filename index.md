# **BAT Merchant Integration Guide**

**Version 1.0**

## **Revision History:**

| **Date** | **Comment** | **Author** | **Version** |
|:--------:|:------------|:----------:|:-----------:|
| 2025-05-14 | BAT Submit Deposit/Payout API<br>BAT Callback Response<br>BAT Requery API<br>BAT Get Supported Bank API | Jeffery Leo | 1.0 |

# Table of Contents

- [1. Overview](#1-overview)
  - [1.1. IP Whitelist](#11-ip-whitelist)
  - [1.2. Domain](#12-domain)
  - [1.3. Setup RSA Key](#13-setup-rsa-key)
  - [1.4. AES Key](#14-aes-key)
  - [1.5. Signature](#15-signature)
- [2. Submit Deposit](#2-submit-deposit)
  - [2.1. Submit Deposit API](#21-submit-deposit-api)
  - [2.2. Request Parameter](#22-request-parameter)
  - [2.3. Data Parameter](#23-data-parameter)
  - [2.4. Form Encrypted Data](#24-form-encrypted-data)
  - [2.5. Form Signature](#25-form-signature)
  - [2.6. Response Parameter](#26-response-parameter)
- [3. Deposit Callback](#3-deposit-callback)
  - [3.1. Callback Response](#31-callback-response)
  - [3.2. Callback Parameter](#32-callback-parameter)
  - [3.3. Data Parameter](#33-data-parameter)
  - [3.4. Decrypt Encrypted Data](#34-decrypt-encrypted-data)
  - [3.5. Verify Signature](#35-verify-signature)
- [4. Requery Deposit](#4-requery-deposit)
  - [4.1. Requery Deposit API](#41-requery-deposit-api)
  - [4.2. Request Parameter](#42-request-parameter)
  - [4.3. Data Parameter](#43-data-parameter)
  - [4.4. Response Parameter](#44-response-parameter)
- [5. Submit Payout](#5-submit-payout)
  - [5.1. Submit Payout API](#51-submit-payout-api)
  - [5.2. Request Parameter](#52-request-parameter)
  - [5.3. Data Parameter](#53-data-parameter)
  - [5.4. Form Encrypted Data](#54-form-encrypted-data)
  - [5.5. Form Signature](#55-form-signature)
  - [5.6. Response Parameter](#56-response-parameter)
  - [5.7. Verify URL](#57-verify-url)
- [6. Payout Callback](#6-payout-callback)
  - [6.1. Callback Response](#61-callback-response)
  - [6.2. Callback Parameters](#62-callback-parameters)
  - [6.3. Data Parameters](#63-data-parameters)
  - [6.4. Decrypt Encrypted Data](#64-decrypt-encrypted-data)
  - [6.5. Verify Signature](#65-verify-signature)
- [7. Requery Payout](#7-requery-payout)
  - [7.1. Requery Payout API](#71-requery-payout-api)
  - [7.2. Request Parameters](#72-request-parameters)
  - [7.3. Data Parameter](#73-data-parameter)
  - [7.4. Response Parameters](#74-response-parameters)
- [8. Get Supported Bank](#8-get-supported-bank)
  - [8.1. Get Supported Bank API](#81-get-supported-bank-api)
  - [8.2. Request Parameter](#82-request-parameter)
  - [8.3. Response Parameter](#83-response-parameter)
- [9. Get Merchant Balance](#9-get-merchant-balance)
  - [9.1. Get Merchant Balance API](#91-get-merchant-balance-api)
  - [9.2. Request Parameter](#92-request-parameter)
  - [9.3. Data Parameter](#93-data-parameter)
  - [9.4. Form Encrypted Data](#94-form-encrypted-data)
  - [9.5. Form Signature](#95-form-signature)
  - [9.6. Response Parameter](#96-response-parameter)
- [10. Payment Method Appendix](#10-payment-method-appendix)
- [11. Bank Appendix](#11-bank-appendix)
- [12. Status Description](#12-status-description)
- [13. Error Appendix](#13-error-appendix)

# 1. Overview

## 1.1. IP Whitelist

To integrate BAT API, kindly provide server outgoing IP to BAT Tech team for whitelisting purpose.

**BAT Staging IP:** 124.217.246.238  
**BAT Production IP:** 20.198.240.65 , 20.212.168.94

## 1.2. Domain

**BAT Staging Domain:** https://mapi.oppay88.com/api  
**BAT Production Domain:** https://mapi.battt.io/api

## 1.3. Setup RSA Key

There are two sets of RSA Keys required for BAT Integration:

**Merchant RSA Key**  
Generated by Merchant, requires passing **Merchant Public Key** to BAT Tech Team to upload in BAT Backoffice. Generate RSA Key in this [website](https://www.devglan.com/online-tools/rsa-encryption-decryption) with 1024 bit.

**BAT RSA Key**  
Generated by BAT, will provide **BAT Public Key** to Merchant for integration purposes.

## 1.4. AES Key

AES Key generated by BAT, will provide **AES Key** to Merchant for integration purpose.

- AES Encryption: [Refer 2.4](#24-form-encrypted-data)
- AES Decryption: [Refer 3.4](#34-decrypt-encrypted-data)

## 1.5. Signature

Signature will be used by RSA Method with sha1 hash algorithm.

# 2. Submit Deposit

## 2.1. Submit Deposit API

**Integration URL**

Staging: `{DOMAIN}/API/Deposit/CreateOrder`  
Production: `{DOMAIN}/API/Deposit/CreateOrder`

**Post Method**: Json Post (Content-Type: application/json)

## 2.2. Request Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Deposit Information<br>[Refer 2.4 Form Encrypted Data](#24-form-encrypted-data) |
| Signature | string | Mandatory | Signature for security purpose (RSA)<br>[Refer 2.5. Form Signature](#25-form-signature) |

**Sample Parameter:**
```json
{
  "MerchantCode": "J1",
  "Version": 0,
  "Data": "VPKYun/otv5qnAtrMMv0OLFkB4G/9GCbTjk9hV644qy/cYF2qutObickADeNMKYj5JD8Q5N087VR8HGz3Gr4hoJQR5EnUlPYXxz7lYSPwvMg/Me5ukIzp/9TcU6JUHLhiP4Nl1X4KrSxaY0mQowSogoiqShrVC8yt6Ri33Innq/9JdaZohKOw0P6NLvmL58XVwV6aQxcjvzVbTfMDOgfT9Z57/QfztLzc00lTEGxZAP92MLOlr3+/v4sEfCTBnq80fftdUAPi44gOpJRNiVcpsRyFuYCcDjPlkprXTQqzyKkYWBtB9CnvyvhhYZ2Dby7TzldV1sOgTIB3VI6A3WB+Juh/lgGIaqOChFsyXe05a+tFpdz4JI9T4EAdg2xDlGdbQTMAGJ8tuBF+Zk/OSnBWDcDs1zttpdN5SUGwJPg/yX/T+THznOZLNqtWf5TfgVcClNeyKwYSWKR+OOwKRDHBSgkBpKLB7nyuqd+FxunQ28LTdJSIayatbQ6nrbqoI3+zji23uTpx41FqUZf/Jiz0w==",
  "Signature": "PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc="
}
```

## 2.3. Data Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2025010101000001 |
| MerchantCustomerId | string | Mandatory | Merchant Customer ID<br>Sample Value: paymentthb |
| CurrencyCode | string | Mandatory | Currency for Deposit<br>Sample Value: THB/VND |
| Amount | string | Mandatory | Amount for Deposit<br>2 decimal places<br>Sample Value: 100.00 |
| CustomerBankCode | string | Conditional | The member bank to use for deposit.<br>Sample Value: VTN<br>[Please Refer Bank Appendix (11)](#11-bank-appendix)<br>*BQR Payment Method not require to pass this parameter* |
| NotifyUrl | string | Mandatory | Server callback URL |
| ReturnUrl | string | Mandatory | Client redirect URL |
| IPAddress | string | Mandatory | Client IP<br>Sample Value: 192.168.0.1 |
| PaymentMethod | string | Mandatory | The Payment Method that customer use for deposit.<br>Sample Value: BQR<br>*BQR - Bank QR*|
| MerchantPaymentRiskId | string | Mandatory | Must pass in MerchantPaymentRiskId.|

## 2.4. Form Encrypted Data

Convert Data Parameter to Json Format and using **AES Key provided by BAT** to perform AES Encryption.

**Example:**

AES Key: Abcd1234

Json Format:
```json
{
  "MerchantCode": "J1",
  "MerchantReferenceId": "2025022138710012",
  "MerchantCustomerId": "paym7hjdrs3x6",
  "CurrencyCode": "VND",
  "Amount": "50.00",
  "CustomerBankCode": "", //Can be empty
  "NotifyUrl": "https://secure.yicamera.com/api_Staging/IT/BAT/AutoReceive.aspx",
  "ReturnUrl": "https://www.yicamera.com/api_Staging/IT/BAT/OvRcv.aspx",
  "IPAddress": "18.167.34.240",
  "PaymentMethod": "BQR"
}
```

Encrypted Data:
```
VPKYun/otv5qnAtrMMv0OLFkB4G/9GCbTjk9hV644qy/cYF2qutObickADeNMKYj5JD8Q5N087VR8HGz3Gr4hoJQR5EnUlPYXxz7lYSPwvMg/Me5ukIzp/9TcU6JUHLhiP4Nl1X4KrSxaY0mQowSogoiqShrVC8yt6Ri33Innq/9JdaZohKOw0P6NLvmL58XVwV6aQxcjvzVbTfMDOgfT9Z57/QfztLzc00lTEGxZAP92MLOlr3+/v4sEfCTBnq80fftdUAPi44gOpJRNiVcpsRyFuYCcDjPlkprXTQqzyKkYWBtB9CnvyvhhYZ2Dby7TzldV1sOgTIB3VI6A3WB+Juh/lgGIaqOChFsyXe05a+tFpdz4JI9T4EAdg2xDlGdbQTMAGJ8tuBF+Zk/OSnBWDcDs1zttpdN5SUGwJPg/yX/T+THznOZLNqtWf5TfgVcClNeyKwYSWKR+OOwKRDHBSgkBpKLB7nyuqd+FxunQ28LTdJSIayatbQ6nrbqoI3+zji23uTpx41FqUZf/Jiz0w==
```

**C# Sample Code:**
```csharp
public static string EncryptStringToBytes(string plainText, string passwordHash, string saltKey)
{
    if (plainText == null || plainText.Length <= 0)
        throw new ArgumentNullException("plainText");
    if (passwordHash == null || passwordHash.Length <= 0)
        throw new ArgumentNullException("passwordHash");
    if (saltKey == null || saltKey.Length <= 0)
        throw new ArgumentNullException("saltKey");

    // Convert strings defining encryption key characteristics to byte arrays
    byte[] key = Encoding.UTF8.GetBytes(passwordHash);
    byte[] salt = Encoding.UTF8.GetBytes(saltKey);

    // Using AES encryption
    using (Aes aes = Aes.Create())
    {
        // Generate the key from the shared secret and the salt
        Rfc2898DeriveBytes rfcKey = new Rfc2898DeriveBytes(key, salt, 1000);

        aes.Key = rfcKey.GetBytes(32);  // Set key size to 256 bits
        aes.IV = rfcKey.GetBytes(16);   // Set initialization vector size to 128 bits

        // Create a decrytor to perform the stream transform
        ICryptoTransform encryptor = aes.CreateEncryptor(aes.Key, aes.IV);

        // Create the streams used for encryption
        using (MemoryStream msEncrypt = new MemoryStream())
        {
            using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
            {
                using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                {
                    // Write all data to the stream
                    swEncrypt.Write(plainText);
                }
            }

            // Return the encrypted bytes from the memory stream in Base64 string
            return Convert.ToBase64String(msEncrypt.ToArray());
        }
    }
}
```

## 2.5. Form Signature

Convert Data Parameter to Json Format and using **Merchant RSA Private Key** to form Signature with **sha1 hash algorithm**.

**Example:**

Merchant RSA Key:
```
MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAOEiX8iKWJebRl8Kpkj8hhT6WUXWd+HvQLc1uvqbCLth+iLIvUXNjhD8sFhtkF4aKe2VHtw8EPRKGWXCf4k7iGuoo1OwOFnYA+9ZBbvgLeSnpS2bt7SvdauGtB6fwp8l7mYwLHM+/JDHXdx+I96Ol0gnGWdDBgxYpwUyhgTuPSOXAgMBAAECgYEA2HCRoVzP+0D+kJTOdNDBnx1oAipEKuQ3VWvEjPXLmUqCjjprLNaHxHEKoJkE+FMzCAQbHSRqMFGkxR4OOsMPTJNOFSZ2RomjeoBL1Nw+w6soaHj45v5zyAdfUxgTm64WDXcg8jIzjTBeZ0HLHWR/KNGQ+BFHo2iyxUt0z4dZOJECQQD6+UWDvlJ+KeGqEhNvOOQ0CSemO5aIA46GuAf1iosZ4YcRkujExD7lVZX2jdjLAIiiGkKx/FJbcw/wuswFy1hDAkEA5aSgDaHFG0Fo/6CgtoCu/JWlTNgZN0npNPhhjvomQlezFCwTU4YlpOib85kdIOI1/RQaEQTU7RRvvhFKZRsMHQJAFXABbhVtunUdX4eXvWJgq8k0Z9CjNQ8It500oNaqtxU6kle4JkaVEMXUv3CyWfS7tw0DMWzaJBGaBPgPwVbzPQJBAKUd0385u9G3HFoBEs1mhWtT5gD0uFzKpgXSOcNmFbBKApcUgejiYZrLLabfhtQoEo2fsIZgJQE6WoYdRJKh+fkCQE7oN7l0C6hlhZB7axSCWduINZP1xbehy6rp97RRlKqFYJqqxHM0CN1WrTjtBcEl6Yh+7Cs5h+w7odvaA+tdtho=
```

Json Format:
```json
{
  "MerchantCode": "J1",
  "MerchantReferenceId": "2025022138710012",
  "MerchantCustomerId": "paym7hjdrs3x6",
  "CurrencyCode": "VND",
  "Amount": "50.00",
  "CustomerBankCode": "", //Can be empty
  "NotifyUrl": "https://secure.yicamera.com/api_Staging/IT/BAT/AutoReceive.aspx",
  "ReturnUrl": "https://www.yicamera.com/api_Staging/IT/BAT/Success.aspx",
  "IPAddress": "18.167.34.240",
  "PaymentMethod": "BQR"
}
```

Signature Result:
```
PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc=
```

## 2.6. Response Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| isSuccess | bool | Mandatory | The result of deposit.<br>Sample Value: true |
| successCode | int | Mandatory | Status code<br>Sample Value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescriptipon | Conditional | Validation Fail Code List<br>[Please Refer Error Appendix (13)](#13-error-appendix) |
| data | Result Model | Mandatory | The result of deposit |

**data Parameter**

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| transactionId | string | Conditional | BAT Deposit ID |
| url | string | Mandatory | The redirection url to BAT Cashier Page.<br>*Remark: Merchant can always redirect to url even validation fail. BAT Cashier Page support display Error Page.*<br> |
| qrCode | string | Conditional | Support *BQR* only. |
| amount | decimal | Mandatory | Transaction amount |
| beneficialBankName | string | Mandatory | Beneficiary Bank Name |
| beneficialBankBranch | string | Mandatory | Beneficiary Bank Branch |
| beneficialBankAccountName | string | Mandatory | Beneficiary Bank Account Name |
| beneficialBankAccountNumber | string | Mandatory | Beneficiary Bank Account Number |

**Sample Response Parameter:**

```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": {
    "transactionId": "D2025022100010708",
    "url": "https://cashier.oppay88.com/D_psp?t=D202502210001070",
    "amount": 50.00,
    "beneficialBankName": "Asia Commrecial Bank",
    "beneficialBankBranch": "Ho Chi Minh",
    "beneficialBankAccountName": "Payment Co., Ltd.",
    "beneficialBankAccountNumber": "6543210"
  }
}
```


# 3. Deposit Callback

## 3.1. Callback Response

Post Method: Json Post (Content-Type: application/json)

Response "success" to stop BAT Callback.

## 3.2. Callback Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| TransactionId | string | Mandatory | BAT Deposit ID<br>Sample Value: D2022022100010708 |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2022010101000001 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Deposit Information<br>[Refer 3.4. Decrypt Encrypted Data](#34-decrypt-encrypted-data) |
| Signature | string | Mandatory | Signature for security purpose (RSA)<br>[Refer 3.5. Verify Signature](#35-verify-signature) |

**Sample Parameter:**

```json
{
  "TransactionId": "D2022022100010708",
  "MerchantReferenceId": "2022022138710012",
  "Version": 0,
  "Data": "v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu",
  "Signature": "OuMmX9meOM0bYs5RbuaOU63biZGES8afWBOeDfZ95an/Dqb7VIfYb9CN/tzMWDvQ7QGqKL5feP9URg5hPb1O7E0ornZL/hf8fYO+jVoAvNcZOir7XFykcPIqYahqC+r5MJ3FiCIWSAEQOXFh1qnr4nISDboH/HOEn5B4+P31HHw="
}
```

## 3.3. Data Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| CurrencyCode | string | Mandatory | Deposit Currency<br>Sample Value: THB/VND |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2022010101000001 |
| Status | int | Mandatory | Deposit Status<br>VerifyFail Status: 4<br>Success Status: 6<br>Fail Status: 7<br>Processing Status: Other Status Value |
| Amount | decimal | Mandatory | Deposit Amount from Member<br>2 decimal places<br>Sample Value: 100.00<br>*BQR Amount and SubmittedAmount will different if there is unique amount*|
| SubmittedAmount | decimal | Mandatory | Submitted Amount from Member<br>2 decimal places<br>Sample Value 100.00 |
| Remark | string | optional | Remark |

## 3.4. Decrypt Encrypted Data

Convert Data Parameter to Json Format and using AES Key provided by BAT to perform AES Encryption.

**Example:**

AES Key: Abcd1234

Encrypted Data:
```
v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu
```

Json Result:
```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND",
  "MerchantReferenceId": "2025022138710012",
  "Status": 6,
  "Amount": 50,
  "Remark": null
}
```

**C# Sample Code:**

```csharp
public static string DecryptStringFromBytes(string encryptedString_base64, string passwordHash, string saltKey)
{
    // Check arguments
    if (encryptedString_base64 == null || encryptedString_base64.Length <= 0)
        throw new ArgumentNullException("encryptedString_base64");
    if (passwordHash == null || passwordHash.Length <= 0)
        throw new ArgumentNullException("passwordHash");
    if (saltKey == null || saltKey.Length <= 0)
        throw new ArgumentNullException("saltKey");

    byte[] cipherTextBytes = Convert.FromBase64String(encryptedString_base64);
    byte[] key = Encoding.UTF8.GetBytes(passwordHash);
    byte[] salt = Encoding.UTF8.GetBytes(saltKey);

    string plaintext = null;

    using (Aes aes = Aes.Create())
    {
        // Generate the key from the shared secret and the salt
        Rfc2898DeriveBytes rfcKey = new Rfc2898DeriveBytes(key, salt, 1000);

        aes.Key = rfcKey.GetBytes(32);  // AES-256
        aes.IV = rfcKey.GetBytes(16);   // 16-byte initialization vector

        // Create a decrytor to perform the stream transform
        ICryptoTransform decryptor = aes.CreateDecryptor(aes.Key, aes.IV);

        // Create the streams used for decryption
        using (MemoryStream msDecrypt = new MemoryStream(cipherTextBytes))
        {
            using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
            {
                using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                {
                    // Read the decrypted bytes from the decrypting stream
                    plaintext = srDecrypt.ReadToEnd();
                }
            }
        }
    }

    return plaintext;
}
```

## 3.5. Verify Signature

Decrypt Encrypted Data to get Json Data, then use the **BAT Public Key** to verify signature based on Signature parameter with **sha1 hash algorithm**.

Example:

BAT RSA Public Key:
```
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCeQZTaHjQRSpZUfcUkhDnzTT1FFr/vAQ8IWZU0KKs5PEyw4UGaSwgJMRuvAMpGzmNlyoPfVYvJcGGKgC842Ca1mnuXElrzwLef93sb74tZxI4xsRk0fKj5Rcs5lm0S5KAvkw/ZvoNvKeYVpGMExstUN/7idhS8rd1ij3rcfe+aAwIDAQAB
```

Signature Parameter:

```
OuMmX9meOM0bYs5RbuaOU63biZGES8afWBOeDfZ95an/Dqb7VIfYb9CN/tzMWDvQ7QGqKL5feP9URg5hPb1O7E0ornZL/hf8fYO+jVoAvNcZOir7XFykcPIqYahqC+r5MJ3FiCIWSAEQOXFh1qnr4nISDboH/HOEn5B4+P31HHw=
```

Verify Signature Result:
```
true
```

# 4. Requery Deposit

## 4.1. Requery Deposit API

**Integration URL**

Staging: `{DOMAIN}/API/Deposit/CheckOrderDetail`  
Production: `{DOMAIN}/API/Deposit/CheckOrderDetail`

**Post Method**: Json Post (Content-Type: application/json)

## 4.2. Request Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Deposit Information<br>[Refer 2.4. Form Encrypted Data](#24-form-encrypted-data) |

**Sample Parameter:**

```json
{
  "MerchantCode": "J1",
  "Version": 0,
  "Data": "v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu"
}
```

## 4.3. Data Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| CurrencyCode | string | Mandatory | Deposit Currency<br>Sample Value: THB/VND |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2022010101000001 |

**Sample Parameter:**

```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND",
  "MerchantReferenceId": "2025022138710012"
}
```

## 4.4. Response Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| isSuccess | bool | Mandatory | The result of deposit.<br>Sample Value: true |
| successCode | int | Mandatory | Status code<br>Sample Value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescription | Conditional | Validation Fail Code List |
| data | Result Model | Mandatory | The result of deposit |

**data Parameter**

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| orderId | string | Mandatory | BAT Deposit ID |
| merchantReferenceId | string | Mandatory | Merchant Deposit ID |
| statusId | int | Mandatory | Deposit Status<br>Success Status: 6<br>Fail Status: 7<br>Processing Status: Other Status Value |
| status | string | Mandatory | Status Description |
| amount | decimal | Mandatory | Deposit Amount<br>2 decimal places |
| submittedAmount | decimal | Mandatory | Submitted Amount<br>2 decimal places |

**Sample Parameter:**

```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": {
    "orderId": "D2025022100010708",
    "merchantReferenceId": "2025022138710012",
    "statusId": 6,
    "status": "Success",
    "amount": 50.00,
    "submittedAmount": 50.00
  }
}
```

# 5. Submit Payout

## 5.1. Submit Payout API

**Endpoint**

`{DOMAIN}/API/Payout/Create`

**Method**

HTTP POST with application/json content type

## 5.2. Request Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Payout Information<br>[Refer 5.4. Form Encrypted Data](#54-form-encrypted-data) |
| Signature | string | Mandatory | Signature (RSA) for security purpose<br>[Refer 5.5. Form Signature](#55-form-signature) |

**Sample Request Parameter**

```json
{
  "MerchantCode": "J1",
  "Version": 0,
  "Data": "xHJVmPlZULSlyRwoX7ldmP5JR7A8CVG0l8qgS73UsKluBNkNBpCCuDrJ8FC0SDvF8dwVyl/h0thuO+jAUpTkvw/YBiA93fHL1bWC4GJMOIfTyt7kcR9CSeCow93lBUeNlU/Ga/ETta9xq+LU162uTtRUnAvipzWWJuLz4yB23EE2+APlChHQAfnHtvAWDEIAr79SgsSA8nYcm0shVBWuXi7c1acvynGd228X4/mu+u3HWqyb5z+y8hxSQAvyoKsK6e3W2O9oWuuyqzfsXrDAY3m6dHsX26lOu45J04hmkqxYUaTtF4h8dOjWt2DR2H0oCLBj0ahrw1D4VQO4rrakc+2tz0umvB5NputA5Vxzg/MjR603c2hZUFWTqAKx4w6UxSi5Ru1AnQLrtCNEpqFZjDqNDM6K+wFjgz4JGfJjhb4T3uLYtSm7Gl54n5mrCMl6t0L6TZRb6KF0Oz7IF3/q8pmXTEyO6TUgdUCl5KXheBUaryKq/cPQX6kNd5ZRYgYVMsVOLB3cGp2hFf/v2dTaVs2JJh84igV1Vc3jhCU3HA0u1tZnE69uC7v5QVfeAIen9afJNFD8durXfcTyODCYfPFldLm6wpdm6y9SKgDCVFV4gskXQ7oJBdCOV4Ai3rRRAAD2zFR9GQ67mFQ6DX6+uwurVoZsPcuHqKJiETUYZkE=",
  "Signature": "PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc="
}
```

## 5.3. Data Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2022010101000001 |
| MerchantCustomerId | string | Mandatory | Merchant Customer ID<br>Sample Value: paymentvnd |
| PayoutAmount | decimal | Mandatory | Amount for Payout<br>2 decimal places<br>Sample Value: 100.00 |
| PayoutFee | decimal | Mandatory | Fee charged by Merchant to Member<br>2 decimal places<br>Sample Value: 0.00 |
| MemberCode | string | Optional | Member Code / Member Nickname<br>Sample Value: PaymentVND001 |
| BankCode | string | Mandatory | The member bank to use for receiving payout.<br>Sample Value: VTN |
| BeneficialAccountNumber | string | Mandatory | The account number to use for receiving payout |
| BeneficialName | string | Mandatory | The member's real name to use for receiving payout |
| CurrencyCode | string | Mandatory | Currency for Payout<br>Sample Value: THB/VND |
| NotifyUrl | string | Mandatory | Server callback URL |
| VerifyUrl | string | Mandatory | Client URL to verify the payout transaction is it legit<br>[Refer to 5.7](#57-verify-url) |
| ReturnUrl | string | Mandatory | Client redirect URL |
| IPAddress | string | Mandatory | Client IP<br>Sample Value: 192.168.0.1 |
| PaymentMethodCode | string | Mandatory | The Payment Method that customer use for payout.<br>Sample Value: LB<br>*LB -- Local Bank* |

## 5.4. Form Encrypted Data

Convert Data Parameter to Json Format and using AES Key provided by BAT to perform AES Encryption.

**Example:**

AES Key: Abcd1234

Json Format:
```json
{
  "MerchantCode": "J1",
  "MerchantReferenceId": "2025022138710012",
  "MerchantCustomerId": "CUST003",
  "PayoutAmount": 100.00,
  "PayoutFee": 0.00,
  "MemberCode": "MEMBER001",
  "BankCode": "DAB",
  "BeneficialAccountNumber": "1521353356",
  "BeneficialName": "SUNATDA KLAENOI",
  "CurrencyCode": "VND",
  "NotifyUrl": "https://secure.yicamera.com/api_Staging/IT/BAT/AutoReceive.aspx",
  "VerifyUrl": "http://demo1351572.mockable.io/payout/verify",
  "ReturnUrl": "https://www.yicamera.com/api_Staging/IT/BAT/OvRcv.aspx",
  "IPAddress": "192.168.1.1",
  "PaymentMethod": "LB"
}
```

Encrypted Data:
```
xHJVmPlZULSlyRwoX7ldmP5JR7A8CVG0l8qgS73UsKluBNkNBpCCuDrJ8FC0SDvF8dwVyl/h0thuO+jAUpTkvw/YBiA93fHL1bWC4GJMOIfTyt7kcR9CSeCow93lBUeNlU/Ga/ETta9xq+LU162uTtRUnAvipzWWJuLz4yB23EE2+APlChHQAfnHtvAWDEIAr79SgsSA8nYcm0shVBWuXi7c1acvynGd228X4/mu+u3HWqyb5z+y8hxSQAvyoKsK6e3W2O9oWuuyqzfsXrDAY3m6dHsX26lOu45J04hmkqxYUaTtF4h8dOjWt2DR2H0oCLBj0ahrw1D4VQO4rrakc+2tz0umvB5NputA5Vxzg/MjR603c2hZUFWTqAKx4w6UxSi5Ru1AnQLrtCNEpqFZjDqNDM6K+wFjgz4JGfJjhb4T3uLYtSm7Gl54n5mrCMl6t0L6TZRb6KF0Oz7IF3/q8pmXTEyO6TUgdUCl5KXheBUaryKq/cPQX6kNd5ZRYgYVMsVOLB3cGp2hFf/v2dTaVs2JJh84igV1Vc3jhCU3HA0u1tZnE69uC7v5QVfeAIen9afJNFD8durXfcTyODCYfPFldLm6wpdm6y9SKgDCVFV4gskXQ7oJBdCOV4Ai3rRRAAD2zFR9GQ67mFQ6DX6+uwurVoZsPcuHqKJiETUYZkE=
```

**C# Sample Code:**

```csharp
public static string EncryptStringToBytes(string plainText, string passwordHash, string saltKey)
{
    if (plainText == null || plainText.Length <= 0)
        throw new ArgumentNullException("plainText");
    if (passwordHash == null || passwordHash.Length <= 0)
        throw new ArgumentNullException("passwordHash");
    if (saltKey == null || saltKey.Length <= 0)
        throw new ArgumentNullException("saltKey");

    // Convert strings defining encryption key characteristics to byte arrays
    byte[] key = Encoding.UTF8.GetBytes(passwordHash);
    byte[] salt = Encoding.UTF8.GetBytes(saltKey);

    // Using AES encryption
    using (Aes aes = Aes.Create())
    {
        // Generate the key from the shared secret and the salt
        Rfc2898DeriveBytes rfcKey = new Rfc2898DeriveBytes(key, salt, 1000);

        aes.Key = rfcKey.GetBytes(32);  // Set key size to 256 bits
        aes.IV = rfcKey.GetBytes(16);   // Set initialization vector size to 128 bits

        // Create a decrytor to perform the stream transform
        ICryptoTransform encryptor = aes.CreateEncryptor(aes.Key, aes.IV);

        // Create the streams used for encryption
        using (MemoryStream msEncrypt = new MemoryStream())
        {
            using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
            {
                using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                {
                    // Write all data to the stream
                    swEncrypt.Write(plainText);
                }
            }

            // Return the encrypted bytes from the memory stream in Base64 string
            return Convert.ToBase64String(msEncrypt.ToArray());
        }
    }
}
```

## 5.5. Form Signature

Convert Data Parameter to Json Format and using Merchant RSA Private Key to form Signature with sha1 hash algorithm.

**Example:**

Merchant RSA Key:
```
MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAOEiX8iKWJebRl8Kpkj8hhT6WUXWd+HvQLc1uvqbCLth+iLIvUXNjhD8sFhtkF4aKe2VHtw8EPRKGWXCf4k7iGuoo1OwOFnYA+9ZBbvgLeSnpS2bt7SvdauGtB6fwp8l7mYwLHM+/JDHXdx+I96Ol0gnGWdDBgxYpwUyhgTuPSOXAgMBAAECgYEA2HCRoVzP+0D+kJTOdNDBnx1oAipEKuQ3VWvEjPXLmUqCjjprLNaHxHEKoJkE+FMzCAQbHSRqMFGkxR4OOsMPTJNOFSZ2RomjeoBL1Nw+w6soaHj45v5zyAdfUxgTm64WDXcg8jIzjTBeZ0HLHWR/KNGQ+BFHo2iyxUt0z4dZOJECQQD6+UWDvlJ+KeGqEhNvOOQ0CSemO5aIA46GuAf1iosZ4YcRkujExD7lVZX2jdjLAIiiGkKx/FJbcw/wuswFy1hDAkEA5aSgDaHFG0Fo/6CgtoCu/JWlTNgZN0npNPhhjvomQlezFCwTU4YlpOib85kdIOI1/RQaEQTU7RRvvhFKZRsMHQJAFXABbhVtunUdX4eXvWJgq8k0Z9CjNQ8It500oNaqtxU6kle4JkaVEMXUv3CyWfS7tw0DMWzaJBGaBPgPwVbzPQJBAKUd0385u9G3HFoBEs1mhWtT5gD0uFzKpgXSOcNmFbBKApcUgejiYZrLLabfhtQoEo2fsIZgJQE6WoYdRJKh+fkCQE7oN7l0C6hlhZB7axSCWduINZP1xbehy6rp97RRlKqFYJqqxHM0CN1WrTjtBcEl6Yh+7Cs5h+w7odvaA+tdtho=
```

Json Format:
```json
{
  "MerchantCode": "J1",
  "MerchantReferenceId": "2025022138710012",
  "MerchantCustomerId": "CUST003",
  "PayoutAmount": 100,
  "PayoutFee": 15,
  "MemberCode": "MEMBER001",
  "BankCode": "DAB",
  "BeneficialAccountNumber": "1521353356",
  "BeneficialName": "SUNATDA KLAENOI",
  "CurrencyCode": "VND",
  "NotifyUrl": "https://secure.yicamera.com/api_Staging/IT/BAT/AutoReceive.aspx",
  "VerifyUrl": "http://demo1351572.mockable.io/payout/verify",
  "ReturnUrl": "https://www.yicamera.com/api_Staging/IT/BAT/OvRcv.aspx",
  "IPAddress": "192.168.1.1",
  "PaymentMethod": "LB"
}
```

Signature Result:
```
PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc=
```

## 5.6. Response Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| isSuccess | boolean | Mandatory | The result of creating payout transaction.<br>Sample Value: true |
| successCode | Int | Mandatory | Status code<br>Sample value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescriptipon | Conditional | Validation Fail Code List<br>[Please Refer 13Error Appendix](#13-error-appendix) |
| data | Result Model | Mandatory | The result of payout |

**data parameter**

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| transactionId | string | Conditional | BAT Payout ID |
| url | string | Optional | The direction url to BAT Cashier Page.<br>*Remark: Payout will have no redirection for now, but this might be the usage in the future |

**Sample Response Parameter:**

Create Payout Successful:
```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": {
    "transactionId": "P2025101200000123"
  }
}
```

Create Payout Unsuccessful (Duplicate merchant reference number):
```json
{
  "isSuccess": false,
  "successCode": 400,
  "errorList": [
    {
      "errorCode": "BAT10000",
      "errorDescription": "Duplicate Merchant Reference Number."
    }
  ],
  "data": null
}
```

## 5.7. Verify URL

Merchant is required to provide a Verify URL to determine their transaction is legit or exists in the Merchant side BO or not. Therefore, we need the merchant side to create an API with HTTP POST method for BAT to fire and response with the following response.

**Verify URL Request Parameters**

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| merchantReferenceId | string | Mandatory | Merchant Reference Id |

**Sample:**
```json
{
  "merchantReferenceId": "2025022138710012"
}
```

**Verify URL Response Parameters:**

Success (Response Status Code 200):

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| status | HttpStatusCode | Mandatory | The result of verifying payout transaction.<br>Sample Value: 200 |
| message | string | Mandatory | Status code<br>Sample value: "Transaction exist in BO" |

**Sample:**
```json
{
  "status": 200,
  "message": "Transaction exist in BO"
}
```

Not found (Response Status Code 404):

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| status | HttpStatusCode | Mandatory | The result of verifying payout transaction.<br>Sample Value: 200 |
| message | string | Mandatory | Status code<br>Sample value: "Transaction exist in BO" |

**Sample:**
```json
{
  "status": 404,
  "message": "Transaction not found in BO"
}
```

# 6. Payout Callback

## 6.1. Callback Response

Post Method: Json Post (Content-Type: application/json)

Response "success" to stop BAT Callback.

## 6.2. Callback Parameters

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| TransactionId | string | Mandatory | BAT Deposit ID<br>Sample Value: P2025101200000123 |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2025010101000001 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Deposit Information<br>[Refer 5.4 Decrypt Encrypted Data](#64-decrypt-encrypted-data) |
| Signature | string | Mandatory | Signature (RSA) for security purpose<br>[Refer 5.5. Verify Signature](#65-verify-signature) |

**Sample Parameters:**
```json
{
  "TransactionId": "P2023101200000123",
  "MerchantReferenceId": "2022022138710012",
  "Version": 0,
  "Data": "v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu",
  "Signature": "Z4axZjAgagYFHl+SYtwquLiB6ItSzQ+5zwGMFGzCZJw9PswP+hG7Mpph/4fK2JzgHEEsQ5vLxgLiuDu8YqK15NUyN/x6VAGZx8KpVpGMyTZdJm8K5xPKIuRiT5GhOH4X03dSBWhVjW/hEzKEiecAylYGDyRsPvm1ViB2bf6N5jM="
}
```

## 6.3. Data Parameters

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| CurrencyCode | string | Mandatory | Payout Currency<br>Sample Value: THB/VND |
| MerchantReferenceId | string | Mandatory | Merchant Transaction ID<br>Sample Value: 2025010101000001 |
| Status | int | Mandatory | Payout Status<br>Success Status: 4<br>Fail Status: 5 |
| Amount | decimal | Mandatory | Submitted amount from member.<br>2 decimal places<br>Sample Value: 100.00 |
| Remark | string | Optional | Remark |
| MerchantFee | decimal | Mandatory | Fee charged by BAT to Merchant<br>2 decimal places<br>Sample Value: 2.00 |
| PayoutFee | decimal | Mandatory | Fee charged by Merchant to Member<br>2 decimal places<br>Sample Value: 1.00 |
| NetAmount | decimal | Mandatory | Payout amount to member<br>2 decimal places<br>Sample Value: 97.00 |

## 6.4. Decrypt Encrypted Data

Convert Data Parameter to Json Format and using AES Key provided by BAT to perform AES Decryption.

### Example:

**AES Key:** Abcd1234

**Encrypted Data:**
```
v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu
```

**Json Result:**
```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND",
  "MerchantReferenceId": "2025022138710012",
  "Status": 4,
  "Amount": 100.00,
  "Remark": null,
  "MerchantFee": 2.00,
  "PayoutFee": 1.00,
  "NetAmount": 97.00
}
```

### C# Sample Code:

```csharp
public static string DecryptStringFromBytes(string encryptedString_base64, string passwordHash, string saltKey)
{
    // Check arguments
    if (encryptedString_base64 == null || encryptedString_base64.Length <= 0)
        throw new ArgumentNullException("encryptedString_base64");
    if (passwordHash == null || passwordHash.Length <= 0)
        throw new ArgumentNullException("passwordHash");
    if (saltKey == null || saltKey.Length <= 0)
        throw new ArgumentNullException("saltKey");

    byte[] cipherTextBytes = Convert.FromBase64String(encryptedString_base64);
    byte[] key = Encoding.UTF8.GetBytes(passwordHash);
    byte[] salt = Encoding.UTF8.GetBytes(saltKey);

    string plaintext = null;

    using (Aes aes = Aes.Create())
    {
        // Generate the key from the shared secret and the salt
        Rfc2898DeriveBytes rfcKey = new Rfc2898DeriveBytes(key, salt, 1000);

        aes.Key = rfcKey.GetBytes(32);  // AES-256
        aes.IV = rfcKey.GetBytes(16);   // 16-byte initialization vector

        // Create a decryptor to perform the stream transform
        ICryptoTransform decryptor = aes.CreateDecryptor(aes.Key, aes.IV);

        // Create the streams used for decryption
        using (MemoryStream msDecrypt = new MemoryStream(cipherTextBytes))
        {
            using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
            {
                using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                {
                    // Read the decrypted bytes from the decrypting stream
                    plaintext = srDecrypt.ReadToEnd();
                }
            }
        }
    }

    return plaintext;
}
```

## 6.5. Verify Signature

Decrypt Encrypted Data to get Json Data, then use the BAT Public Key to verify signature based on Signature parameter with sha1 hash algorithm.

**Example:**

BAT RSA Public Key:
```
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCxSUAvMVQGU5lp4CTVCj3smfYZvWUZJUU5wTuWOq3uy0ZN8r+hyCALbn6MA62JB4oDe8W6UFia2wJIAhh+G7f6u05UfMv1dYdpGULtvtzWl4W0RIgaDU0vXpYlN2+srZB8j66nO5IPp1TorZCEkUcha8Tj/5ZcU8lZUviznF47EQIDAQAB
```

Signature Parameter:
```
Z4axZjAgagYFHl+SYtwquLiB6ItSzQ+5zwGMFGzCZJw9PswP+hG7Mpph/4fK2JzgHEEsQ5vLxgLiuDu8YqK15NUyN/x6VAGZx8KpVpGMyTZdJm8K5xPKIuRiT5GhOH4X03dSBWhVjW/hEzKEiecAylYGDyRsPvm1ViB2bf6N5jM=
```

Verify Signature Result:
```
True
```

# 7. Requery Payout

## 7.1. Requery Payout API

**Endpoint:**

`{DOMAIN}/API/Payout/CheckOrderDetail`

**Method:**

HTTP POST with application/json content type

## 7.2. Request Parameters

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Payout Information<br>[Refer 5.4. Form Encrypted Data](#54-form-encrypted-data) |

**Sample Parameter:**

```json
{
  "MerchantCode": "J1",
  "Version": 0,
  "Data": "v8hXW/3aaEwk0ol8BKxwsfHwF07od+tRHSVoknE1C3OX15qaFQcTyE0YAqykfvKCVpFAb2NRZZw5SFQKSu5SYc8/0YfseqVrAPCtT63wdub4Itlv+eWcBTUUijFuUiqHGexZYbBh0kRa2ZwlBs0vMCwDPL4I2xhJ50tHtzdH3pv1LTTUTVjXvRAZ/jesYSdu"
}
```

## 7.3. Data Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| MerchantReferenceId | int | Mandatory | Merchant Transaction ID<br>Sample Value: 2022010101000001 |
| CurrencyCode | string | Mandatory | Payout Currency<br>Sample Value: THB/VND |

**Sample Parameters:**

```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND",
  "MerchantReferenceId": "2025022138710012"
}
```

## 7.4. Response Parameters

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| isSuccess | boolean | Mandatory | The result of requery payout<br>Sample Value: true |
| successCode | int | Mandatory | Status Code<br>Sample Value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescription | Conditional | Validation Fail Code List<br>[Please Refer 13 Error Appendix](#13-error-appendix) |
| data | Result Model | Mandatory | The result of requery payout |

**data Parameters**

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| orderId | string | Mandatory | Optimus Payout ID |
| merchantReferenceId | int | Mandatory | Merchant Payout ID<br>Sample Value: 2025010101000001 |
| statusId | int | Mandatory | Payout Status<br>Success Status: 4<br>Fail Status: 5 |
| status | string | Mandatory | Status Description<br>1.  Pending<br>2.  Assigned<br>3.  Processing<br>4.  Success<br>5.  Fail<br>6.  Unknown<br>[Please Refer 12 Status Description](#12-status-description) |
| amount | decimal | Mandatory | Payout Amount<br>2 decimal places |
| merchantFee | decimal | Mandatory | Fee charged by BAT to Merchant<br>2 decimal places<br>Sample Value: 2.00 |
| payoutFee | decimal | Mandatory | Fee charged by Merchant to Member<br>2 decimal places<br>Sample Value: 1.00 |
| netAmount | decimal | Mandatory | Payout amount to member<br>2 decimal places<br>Sample Value: 97.00 |

**Sample Parameters:**

```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": {
    "orderId": "P2025101200000123",
    "merchantReferenceId": "2025022138710012",
    "statusId": 4,
    "status": "Success",
    "amount": 100.00,
    "merchantFee": 2.00,
    "payoutFee": 1.00,
    "netAmount": 97.00
  }
}
```

# 8. Get Supported Bank

## 8.1. Get Supported Bank API

**Endpoint:**

`{DOMAIN}/API/Bank/GetSupportedBank`

**Post Method:** GET

## 8.2. Request Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |

**Sample Request:**

`{DOMAIN}/API/Bank/GetSupportedBank?MerchantCode=J1`

## 8.3. Response Parameter

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| isSuccess | bool | Mandatory | The result of deposit.<br>Sample Value: true |
| successCode | int | Mandatory | Status code<br>Sample Value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescription | Conditional | Validation Fail Code List |
| data | List of Result Model | Mandatory | The result of supported bank list |

**data Parameter**

| **Parameter** | **Data Type** | **Required** | **Description** |
|---------------|---------------|--------------|-----------------|
| bankName | string | Mandatory | English Bank Name |
| bankNameOrigin | string | Mandatory | Bank Name |
| bankCode | string | Mandatory | Bank Code<br>Sample Value : ACB<br>[Please Refer Bank Appendix (11)](#11-bank-appendix) |
| currencyCode | string | Mandatory | Currency<br>Sample Value : VND |
| merchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |

**Sample Parameter:**

```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": [
    {
        "bankName": "ASIA COMMERCIAL BANK",
        "bankNameOrigin": "Ngân hàng thương mại cổ phần Á Châu",
        "bankCode": "ACB",
        "currencyCode": "VND",
        "merchantCode": "J1"
    },
    {
        "bankName": "DongA Bank",
        "bankNameOrigin": "Ngân hàng thương mại cổ phần Đông Á",
        "bankCode": "DAB",
        "currencyCode": "VND",
        "merchantCode": "J1"
    }
  ]
}
```

# 9. Get Merchant Balance

## 9.1. Get Merchant Balance API

**Endpoint:**

`{DOMAIN}/API/Merchant/GetMerchantBalance`

**Method:**

HTTP POST with application/json content type

## 9.2. Request Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| Version | int | Mandatory | Api Version<br>Sample Value: 0 |
| Data | string | Mandatory | Encrypted Payout Information<br>[Refer 9.5 Form Encrypted Data](#94-form-encrypted-data) |
| Signature | string | Mandatory | Signature (RSA) for security purpose<br>[Refer 9.5. Form Signature](#95-form-signature) |

**Sample Request Parameter:**

```json
{
  "MerchantCode": "J1",
  "Version": 0,
  "Data": "xHJVmPlZULSlyRwoX7ldmP5JR7A8CVG0l8qgS73UsKluBNkNBpCCuDrJ8FC0SDvF8dwVyl/h0thuO+jAUpTkvw/YBiA93fHL1bWC4GJMOIfTyt7kcR9CSeCow93lBUeNlU/Ga/ETta9xq+LU162uTtRUnAvipzWWJuLz4yB23EE2+APlChHQAfnHtvAWDEIAr79SgsSA8nYcm0shVBWuXi7c1acvynGd228X4/mu+u3HWqyb5z+y8hxSQAvyoKsK6e3W2O9oWuuyqzfsXrDAY3m6dHsX26lOu45J04hmkqxYUaTtF4h8dOjWt2DR2H0oCLBj0ahrw1D4VQO4rrakc+2tz0umvB5NputA5Vxzg/MjR603c2hZUFWTqAKx4w6UxSi5Ru1AnQLrtCNEpqFZjDqNDM6K+wFjgz4JGfJjhb4T3uLYtSm7Gl54n5mrCMl6t0L6TZRb6KF0Oz7IF3/q8pmXTEyO6TUgdUCl5KXheBUaryKq/cPQX6kNd5ZRYgYVMsVOLB3cGp2hFf/v2dTaVs2JJh84igV1Vc3jhCU3HA0u1tZnE69uC7v5QVfeAIen9afJNFD8durXfcTyODCYfPFldLm6wpdm6y9SKgDCVFV4gskXQ7oJBdCOV4Ai3rRRAAD2zFR9GQ67mFQ6DX6+uwurVoZsPcuHqKJiETUYZkE=",
  "Signature": "PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc="
}
```

## 9.3. Data Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| MerchantCode | string | Mandatory | Merchant Account Code<br>Sample Value: J1 |
| CurrencyCode | string | Mandatory | Merchant Currency Code<br>Sample Value: VND |

## 9.4. Form Encrypted Data

Convert Data Parameter to Json Format and using AES Key provided by BAT to perform AES Encryption.

**Example:**

AES Key: Abcd1234

Json Format:
```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND"
}
```

Encrypted Data:
```
xHJVmPlZULSlyRwoX7ldmP5JR7A8CVG0l8qgS73UsKluBNkNBpCCuDrJ8FC0SDvF8dwVyl/h0thuO+jAUpTkvw/YBiA93fHL1bWC4GJMOIfTyt7kcR9CSeCow93lBUeNlU/Ga/ETta9xq+LU162uTtRUnAvipzWWJuLz4yB23EE2+APlChHQAfnHtvAWDEIAr79SgsSA8nYcm0shVBWuXi7c1acvynGd228X4/mu+u3HWqyb5z+y8hxSQAvyoKsK6e3W2O9oWuuyqzfsXrDAY3m6dHsX26lOu45J04hmkqxYUaTtF4h8dOjWt2DR2H0oCLBj0ahrw1D4VQO4rrakc+2tz0umvB5NputA5Vxzg/MjR603c2hZUFWTqAKx4w6UxSi5Ru1AnQLrtCNEpqFZjDqNDM6K+wFjgz4JGfJjhb4T3uLYtSm7Gl54n5mrCMl6t0L6TZRb6KF0Oz7IF3/q8pmXTEyO6TUgdUCl5KXheBUaryKq/cPQX6kNd5ZRYgYVMsVOLB3cGp2hFf/v2dTaVs2JJh84igV1Vc3jhCU3HA0u1tZnE69uC7v5QVfeAIen9afJNFD8durXfcTyODCYfPFldLm6wpdm6y9SKgDCVFV4gskXQ7oJBdCOV4Ai3rRRAAD2zFR9GQ67mFQ6DX6+uwurVoZsPcuHqKJiETUYZkE=
```

**C# Sample Code:**

```csharp
public static string EncryptStringToBytes(string plainText, string passwordHash, string saltKey)
{
    if (plainText == null || plainText.Length <= 0)
        throw new ArgumentNullException("plainText");
    if (passwordHash == null || passwordHash.Length <= 0)
        throw new ArgumentNullException("passwordHash");
    if (saltKey == null || saltKey.Length <= 0)
        throw new ArgumentNullException("saltKey");

    // Convert strings defining encryption key characteristics to byte arrays
    byte[] key = Encoding.UTF8.GetBytes(passwordHash);
    byte[] salt = Encoding.UTF8.GetBytes(saltKey);

    // Using AES encryption
    using (Aes aes = Aes.Create())
    {
        // Generate the key from the shared secret and the salt
        Rfc2898DeriveBytes rfcKey = new Rfc2898DeriveBytes(key, salt, 1000);

        aes.Key = rfcKey.GetBytes(32);  // Set key size to 256 bits
        aes.IV = rfcKey.GetBytes(16);   // Set initialization vector size to 128 bits

        // Create a decrytor to perform the stream transform
        ICryptoTransform encryptor = aes.CreateEncryptor(aes.Key, aes.IV);

        // Create the streams used for encryption
        using (MemoryStream msEncrypt = new MemoryStream())
        {
            using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
            {
                using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                {
                    // Write all data to the stream
                    swEncrypt.Write(plainText);
                }
            }

            // Return the encrypted bytes from the memory stream in Base64 string
            return Convert.ToBase64String(msEncrypt.ToArray());
        }
    }
}
```

## 9.5. Form Signature

Convert Data Parameter to Json Format and using Merchant RSA Private Key to form Signature with sha1 hash algorithm.

**Example:**

Merchant RSA Key:
```
MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAOEiX8iKWJebRl8Kpkj8hhT6WUXWd+HvQLc1uvqbCLth+iLIvUXNjhD8sFhtkF4aKe2VHtw8EPRKGWXCf4k7iGuoo1OwOFnYA+9ZBbvgLeSnpS2bt7SvdauGtB6fwp8l7mYwLHM+/JDHXdx+I96Ol0gnGWdDBgxYpwUyhgTuPSOXAgMBAAECgYEA2HCRoVzP+0D+kJTOdNDBnx1oAipEKuQ3VWvEjPXLmUqCjjprLNaHxHEKoJkE+FMzCAQbHSRqMFGkxR4OOsMPTJNOFSZ2RomjeoBL1Nw+w6soaHj45v5zyAdfUxgTm64WDXcg8jIzjTBeZ0HLHWR/KNGQ+BFHo2iyxUt0z4dZOJECQQD6+UWDvlJ+KeGqEhNvOOQ0CSemO5aIA46GuAf1iosZ4YcRkujExD7lVZX2jdjLAIiiGkKx/FJbcw/wuswFy1hDAkEA5aSgDaHFG0Fo/6CgtoCu/JWlTNgZN0npNPhhjvomQlezFCwTU4YlpOib85kdIOI1/RQaEQTU7RRvvhFKZRsMHQJAFXABbhVtunUdX4eXvWJgq8k0Z9CjNQ8It500oNaqtxU6kle4JkaVEMXUv3CyWfS7tw0DMWzaJBGaBPgPwVbzPQJBAKUd0385u9G3HFoBEs1mhWtT5gD0uFzKpgXSOcNmFbBKApcUgejiYZrLLabfhtQoEo2fsIZgJQE6WoYdRJKh+fkCQE7oN7l0C6hlhZB7axSCWduINZP1xbehy6rp97RRlKqFYJqqxHM0CN1WrTjtBcEl6Yh+7Cs5h+w7odvaA+tdtho=
```

Json Format:
```json
{
  "MerchantCode": "J1",
  "CurrencyCode": "VND"
}
```

Signature Result:
```
PH0EqsXIpgVfzK1fsDu/Q93+2lP24/A4dNj16ZMDJTt67mdjmwxd0c0/pbvsw5cVhX5OE2KodzuVl5S4chS2Oovq01vPqd/G54GH+XNYw7H425YZo949qd08nDe6IaMfcHf61I5GlvT4V3coN87QnfoRJ8LCkSgWaNpb3yq5agc=
```

## 9.6. Response Parameter

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| isSuccess | boolean | Mandatory | The result of return merchant balance<br>Sample Value: true |
| successCode | Int | Mandatory | Status code<br>Sample value: 200 |
| errorMessage | string | Conditional | General Exception |
| errorList | List of Model<br>-ErrorCode<br>-ErrorDescriptipon | Conditional | Validation Fail Code List<br>[Please Refer 13 Error Appendix](#13-error-appendix) |
| data | Result Model | Mandatory | The result of payout |

**data parameter**

| **Parameter** | **Data Type** | **Mandatory / Optional** | **Description** |
|---------------|---------------|--------------------------|-----------------|
| availableBalance | string | Conditional | Available Balance Value |

**Sample Response Success:**

```json
{
  "isSuccess": true,
  "successCode": 200,
  "data": {
    "availableBalance": "1000.00"
  }
}
```

# 10. Payment Method Appendix

| **Payment Method Code** | **Payment Method Name** | **Supported Method** |
|-------------------------|-------------------------|----------------------|
| BQR | Bank QR | Deposit |
| LB | Local Bank | Payout |

# 11. Bank Appendix

## 11.1 THB

| **Bank Code** | **English Bank Name** | **Origin Bank Name** |
|---------------|------------------------|----------------------|
| KBANK | KASIKORNBANK PCL | ธนาคารกสิกรไทย |
| KTBPC | KRUNG THAI BANK PUBLIC COMPANY LTD | ธนาคารกรุงไทย |
| TSCBPC | THE SIAM COMMERCIAL BANK PUBLIC COMPANY | ธนาคารไทยพาณิชย์ |
| BAAC | Bank of Agriculture and Agricultural Cooperatives | Bank of Agriculture and Agricultural Cooperatives |
| BOANAS | Bank of America NT and SA | Bank of America NT and SA |
| BOCTP | Bank of China (Thai) PCL | Bank of China (Thai) PCL |
| BPT | BNP Paribas Thailand | BNP Paribas Thailand |
| CBNA | Citibank, NA | Citibank, NA |
| CIMBT | CIMB Thai | CIMB Thai |
| DBA | Deutsche Bank Aktiengesellschaft | Deutsche Bank Aktiengesellschaft |
| GHB | Government Housing Bank | Government Housing Bank |
| GSB | Government Savings Bank | Government Savings Bank |
| IACBOCTP | Industrial and Commercial Bank of China (Thai) PCL | Industrial and Commercial Bank of China (Thai) PCL |
| IBOT | Islamic Bank of Thailand | Islamic Bank of Thailand |
| JCBBB | JPMorgan Chase Bank, Bangkok Branch | JPMorgan Chase Bank, Bangkok Branch |
| KBP | Kiatnakin Bank PCL | Kiatnakin Bank PCL |
| LHB | Land and Houses Bank | Land and Houses Bank |
| MCB | Mizuho Corporate Bank | Mizuho Corporate Bank |
| MICB | Mega International Commercial Bank | Mega International Commercial Bank |
| SCBTP | Standard Chartered Bank (Thai) PCL | Standard Chartered Bank (Thai) PCL |
| SMBC | Sumitomo Mitsui Banking Corporation | Sumitomo Mitsui Banking Corporation |
| TBP | Thanachart Bank PCL | Thanachart Bank PCL |
| THASBC | The Hongkong and Shanghai Banking Corporation | The Hongkong and Shanghai Banking Corporation |
| TISCOBP | TISCO Bank PCL | TISCO Bank PCL |
| TMBBP | TMB Bank PCL | TMB Bank PCL |
| TRBOSBB | The Royal Bank of Scotland, Bangkok Branch | The Royal Bank of Scotland, Bangkok Branch |
| TTCRB | The Thai Credit Retail Bank | The Thai Credit Retail Bank |
| TTB | TMBThanachart Bank PCL | TMBThanachart Bank PCL |

## 11.2 VND

| **Bank Code** | **English Bank Name** | **Origin Bank Name** |
|---------------|------------------------|----------------------|
| ABB | AB Bank | NHTMCP An Binh |
| ACB | Asia Commercial Bank | Ngân hàng thương mại cổ phần Á Châu |
| AGR | Vietnam Bank for Agriculture and Rural Development (Agribank) | Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam |
| BAB | Bac A bank | NHTMCP Bac A |
| BIDV | Bank for Investment and Development of Vietnam | Ngân hàng TMCP Đầu tư và Phát triển Việt Nam |
| BVB | Bao Viet Bank | NH BAO VIET |
| DAB | DongA Bank | Ngan hang dong a dien tu |
| EXB | Exim Bank | NHTMCP Xuat Nhap Khau |
| GPB | GP Bank | Ngân Hàng TMCP Dầu Khí Toàn Cầu |
| HDB | HD Bank | NHTMCP phat trien Tp HCM |
| HLB | Hong Leong Bank | Ngân Hàng TNHH Một Thành Viên Hong Leong Việt Nam |
| KLB | Kien Long bank | NHTMCP Kien Long |
| LPB | Lien Viet Post Bank | Ngân hàng TMCP Bưu Điện Liên Việt |
| MBB | MB Bank | NHTMCP Quan Doi |
| MSB | MSB | Vietnam Maritime Commercial Joint Stock Bank |
| NAB | Nam A Bank | NHTMCP Nam A |
| NCB | National citizen bank | Ngan hang TMCP Quoc Dan |
| OB | Ocean Bank | Ngân hàng TMCP Đại Dương |
| OCB | Orient Commercial Joint Stock Bank | Orient Commercial Joint Stock Bank |
| PGB | PGBank | Ngân hàng TMCP Xăng dầu Petrolimex |
| PVCOM | PVCOM | Trang chủ \| Ngân hàng TMCP Đại Chúng Việt Nam |
| SAB | Sacom Bank | Ngân hàng thương mại cổ phần Sài Gòn Thương Tín |
| SCB | Saigon Commercial Bank | NHTMCP Sai Gon |
| SEAB | SeABank | Southeast Asia Commercial Joint Stock Bank |
| SGB | SAIGONBANK | Ngân Hàng TMCP Sài Gòn Công Thương |
| SHB | Saigon - Hanoi Commercial Joint Stock Bank | Ngân hàng TMCP Sài Gòn - Hà Nội |
| SHBVN | Shinhan Bank VN | Ngân hàng TNHH MTV Shinhan Việt Nam |

# 12. Status Description

| **Id** | **Status** | **Description** |
|--------|------------|-----------------|
| 1 | Pending | The payout transaction has been created by Merchant and went through merchant verification. |
| 2 | Assigned | Payout transaction is ready to transfer |
| 3 | Processing | Processing on the payout transaction |
| 4 | Success | Payout transaction has transfer successfully |
| 5 | Fail | Payout transaction is failed to transfer. |
| 6 | Unknown | Payout transaction is required to manual approved / reject through BAT BackOffice |

# 13. Error Appendix

| Error Code | Error Description |
|------------|-------------------|
| BAT 10000 | Duplicate Merchant Reference Number. |
| BAT 10001 | Invalid Bank Code. |
| BAT 10002 | Bank account not available. |
| BAT 10003 | Merchant setting not setup completely. |
| BAT 10004 | Company Bank account does not exist. |
| BAT 10005 | Invalid Transaction Amount. |
| BAT 10006 | Invalid Payment Method. |
| BAT 10007 | Merchant Cashier URL not available. |
| BAT 10008 | Invalid Unique Amount. |
| BAT 10009 | Services URL not available. |
| BAT 10010 | Bank Account Matching Type not available. |
| BAT 10011 | Invalid Unique Amount. Out Of Range. |
| BAT 10012 | Merchant Reference failed to verify. |
| BAT 10013 | Merchant Balance is not sufficient. |
| BAT 10014 | No PaymentRisk Able to be found. |
| BAT 10015 | No Deposit Group Setting Able To Be Found. |
